<!DOCTYPE html>

<!-- EJS for dynamic table on home page -->
<% function user(user) { %>
  <% for(var i=0; i<user.locations.length; i++) { if(i==0){ %>
    <tr>
        <!-- Write if/else control flow to determine whether to display green or red icon, dependant on status. -->
        <td> <image src="/img/open.png" width="15" height="15" align="center"> </td>
        <td>  <a href="http://<%= user.website %>"> <%= user.display_name%></a>,   <%= user.locations[i].location_name %> </td>
        <td> <%= user.locations[i].address %></td>
        <!--<td><%= user.rating.yelp_rating %></td>-->
        <td> <img src="/img/Rating/coffeemed.jpg"> </td>
        <td>% <%= user.avg_price %></td>
    </tr>
  <% } }%>
<% } %>

<html>
	<head>
		<meta charset="utf-8">
		<title>CheapBean</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css"> <!-- Default bootstrap 2.3.x stylesheet -->
    <link rel="stylesheet" type="text/css" href="css/frugallycaffeinated.css"><!-- Hotfixes on top of stylesheet-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-47543649-2', 'cheapbean.com');
      ga('send', 'pageview');</script> <!-- Google Analytics, said to perform better in the head, but unsure with the advent of async -->
	</head>
	<body>
  <div id="wrap">
      <!-- Menu Bar
      ================================================== -->
  	  <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <a class="brand" href="#">CheapBean</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href='about.html'>About</a></li>
              </ul> 
              <!-- Search Bar
              ================================================== -->
              <form class="navbar-form pull-right">
                <input class="span6" type="text" placeholder="Search">
              </form> 
            </div>
          </div>
        </div>
      </div>
      <!-- Carousel for image display
      ================================================== -->
      <div id="myCarousel" class="carousel slide">
        <div class="carousel-inner">
          <div class="item active">
            <img src="img/Carousel/coffeeandbeans.jpg" width="100%" alt="">
              <div class="carousel-caption">
                <div class="container">
                <p class="lead">Welcome to CheapBean, the authority on finding the best inexpensive coffeeshops in your area.</p>
              </div>
            </div>
          </div>
          <div class="item">
            <img src="img/Carousel/es.jpg" width="100%" alt="">
              <div class="carousel-caption">
                <div class="container">
                <p class="lead">Welcome to CheapBean, the authority on finding the best inexpensive coffeeshops in your area.</p>
              </div>
            </div>
          </div>
          <div class="item">
            <img src="img/Carousel/sw.jpg" width="100%" alt="">
            <div class="carousel-caption">
              <div class="container">
                <p class="lead">Welcome to CheapBean, the authority on finding the best inexpensive coffeeshops in your area.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row-fluid">
      <!-- Data Table + Tablesorter 2.0
      ================================================== -->
      <div class="span6">
        <!-- Alert bar to show progress text -->
        <div class="alert alert-success" style="width:85%; margin-left:7%; ">
          <center>More coffeeshops are constantly being added and updated. Check back soon!</center>
        </div>
        <!-- Styled Table insertion -->
        <table id="hor-minimalist-a" summary="Front Page Coffeeshops">
          <thead>
          <tr>
            <th style="width: 5%">&nbsp;Open</th>
            <th style="width: 30%">Coffeeshop</th>
            <th style="width: 30%">Location</th>
            <th style="width: 10%; padding:5px">Rating</th>
            <th style="width: 20%; padding:5px">Difference from<br>Average Price</th>
          </tr>
          <!-- Map users array to user for EJS -->
          <% users.map(user) %>
        </table>
        <!-- Thinking about adding an alert box for global price average
        <div class="alert alert-success" style="width:85%; margin-left:7%; ">
          <center>The average price for //Index Item// in Toronto is $2.32</center>
        </div> -->
      </div> 
      <!-- Google Maps implimentation
      ================================================== -->
      <div class="span6">
        <!-- Taken from web example. Supposed to make map responsive -->
        <div class="fluid-wrapper">
          <div id="map"></div>
        </div>
     </div>
    </div>
    <!-- Pushes rest of content down page
    ================================================== -->  
    <div id="push"></div>
  <!-- Closes wrap
  ================= -->
  </div>
    <!-- Footer
    ================================================== -->
    <div id="footer">
        <div class="row">
          <div class="span6">
            <img class="bitcoin" src="/img/btc.png" width="25" height="25">
            <span class="bitcoin">19pNmErZFMC4NAhzXEqoKEt1kyxUtw6Ru7</span>
          </div>
            <div class="span6">
            <p class="copywrite">&copy; CheapBean 2014 &middot; <a href="http://lancestacenko.me" style="color: #000000; border-bottom:1px double;">Created by Lance Stacenko</a></p>
          </div>
        </div>
    </div>
    <!-- Added dependancies to bottom to save on load time
    ================================================== -->
    <script type="text/javascript" src="js/jquery-1.11.0.js"></script> <!-- JQuery -->
    <script type="text/javascript" src="js/bootstrap.js"></script>  <!-- Bootstrap -->
    <script type="text/javascript" src="js/carousel.js"></script>  <!-- Bootstrap, Carousel -->
    <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script>  <!-- Tablesorter -->
    <script type="text/javascript" src="js/ejs.js"></script>  <!-- EJS -->
    <script type="text/javascript" src="js/underscore.js"></script> <!-- Underscore -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASm3CwaK9qtcZEWYa-iQwHaGi3gcosAJc&sensor=false"></script> <!-- Google Maps -->
    <script data-cfasync="false" type='text/javascript'>/*<![CDATA[*/window.olark||(function(c){var f=window,d=document,l=f.location.protocol=="https:"?"https:":"http:",z=c.name,r="load";var nt=function(){
      f[z]=function(){
      (a.s=a.s||[]).push(arguments)};var a=f[z]._={
      },q=c.methods.length;while(q--){(function(n){f[z][n]=function(){
      f[z]("call",n,arguments)}})(c.methods[q])}a.l=c.loader;a.i=nt;a.p={
      0:+new Date};a.P=function(u){
      a.p[u]=new Date-a.p[0]};function s(){
      a.P(r);f[z](r)}f.addEventListener?f.addEventListener(r,s,false):f.attachEvent("on"+r,s);var ld=function(){function p(hd){
      hd="head";return["<",hd,"></",hd,"><",i,' onl' + 'oad="var d=',g,";d.getElementsByTagName('head')[0].",j,"(d.",h,"('script')).",k,"='",l,"//",a.l,"'",'"',"></",i,">"].join("")}var i="body",m=d[i];if(!m){
      return setTimeout(ld,100)}a.P(1);var j="appendChild",h="createElement",k="src",n=d[h]("div"),v=n[j](d[h](z)),b=d[h]("iframe"),g="document",e="domain",o;n.style.display="none";m.insertBefore(n,m.firstChild).id=z;b.frameBorder="0";b.id=z+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){
      b.src="javascript:false"}b.allowTransparency="true";v[j](b);try{
      b.contentWindow[g].open()}catch(w){
      c[e]=d[e];o="javascript:var d="+g+".open();d.domain='"+d.domain+"';";b[k]=o+"void(0);"}try{
      var t=b.contentWindow[g];t.write(p());t.close()}catch(x){
      b[k]=o+'d.write("'+p().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}a.P(2)};ld()};nt()})({
      loader: "static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});
      /* custom configuration goes here (www.olark.com/documentation) */
      olark.identify('1669-606-10-5663');/*]]>*/</script><noscript><a href="https://www.olark.com/site/1669-606-10-5663/contact" title="Contact us" target="_blank">Questions? Feedback?</a> powered by <a href="http://www.olark.com?welcome" title="Olark live chat software">Olark live chat software</a></noscript>
    <script>
      google.maps.event.addDomListener(window, 'load', init);
  
      function init() {
          var mapOptions = {
              zoom: 12,
              disableDefaultUI: true,
              center: new google.maps.LatLng(43.6617, -79.3950),
              styles: [{featureType:"administrative",stylers:[{visibility:"all"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"simplified"}]},{featureType:"landscape",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{visibility:"off"}]},{featureType:"road.local",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"water",stylers:[{color:"#84afa3"},{lightness:52}]},{stylers:[{saturation:-17},{gamma:0.36}]},{featureType:"transit.line",elementType:"on",stylers:[{color:"#3f518c"}]}]
              };
          var mapElement = document.getElementById('map');
          var map = new google.maps.Map(mapElement, mapOptions);

          /*next step is to write a foreach loop that iterates through array users and adds markers in sequence. 
          $.each(users, function(index, value) {
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(43.6617, -79.3950), //users.coffeeshop[i].latlong
                map: map,
                title: 'title' //users.coffeeshop[i].location_name,
          });*/
      }</script><!-- Map -->
    <script>
      $(function(){

      // Cache reference to map container
      var $map = $("#map");
      var $table = $("");

      // A function for updating max-height
      function updateMaxHeight () {
          var carousel = $('#myCarousel'), footer = $('#footer'), win_h = $(window).height(), margin = 40;


          var map_height = win_h - footer.height() - carousel.height() - margin;
          console.log(map_height)
          $map.css("height", map_height);
      }

      // Version of updateMaxHeight that will run no more than once every 500ms
      //var updateMaxHeightThrottled = _.throttle(updateMaxHeight, 500);

      // Call updateMaxHeightThrottled when browser resize event fires
        $(window).on("resize", updateMaxHeight); //Call on resize
        updateMaxHeight(); //Call on load
      });

      </script><!-- Map resizing -->
    <script>
      $(document).ready(function() 
      { 
        $("#myTable").tablesorter(); 
      } 
      ); 
      </script>

     <!-- EJS --><!-- Tablesorter -->
    <script>
        !function ($) {
          $(function(){
            // carousel demo
            $('#myCarousel').carousel();{

            }
          })
        }(window.jQuery)</script> <!-- Carousel -->
	</body>
</html>